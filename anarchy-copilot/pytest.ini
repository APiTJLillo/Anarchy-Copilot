[pytest]
# Test discovery and execution
testpaths = tests
python_files = test_*.py
python_classes = Test* *Tests *Suite
python_functions = test_*

# Test categories
markers =
    unit: Unit tests (fast, no external dependencies)
    integration: Integration tests (may require external services)
    api: API endpoint tests
    slow: Tests that take longer to run
    network: Tests requiring network access
    example: Example test cases
    security: Security-related tests

# Test execution settings
addopts =
    --verbose
    --strict-markers
    --tb=short
    --cov=anarchy_copilot
    --cov=recon_module
    --cov=vuln_module
    --cov-report=term-missing
    --cov-report=html
    --cov-report=xml
    --junitxml=test-reports/junit.xml
    --html=test-reports/report.html

# Coverage settings
[coverage:run]
branch = True
source =
    anarchy_copilot
    recon_module
    vuln_module
omit =
    */__init__.py
    */migrations/*
    */tests/*
    */stubs/*
    setup.py

[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    raise NotImplementedError
    if __name__ == .__main__.:
    pass
    raise ImportError
    except ImportError:
    if TYPE_CHECKING:
show_missing = True
fail_under = 80

# Test timeout settings
timeout = 300

# Environment settings
env =
    PYTHONPATH=.
    TESTING=true
    TEST_DEBUG=true

# Logging settings
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s (%(filename)s:%(lineno)s)
log_cli_date_format = %Y-%m-%d %H:%M:%S

# File patterns to ignore
norecursedirs = 
    .git
    .tox
    .env
    dist
    build
    migrations
    stubs

# Temp file handling
tmp_path_retention_count = 3
tmp_path_retention_policy = failed

# xdist settings (parallel test execution)
[pytest-xdist]
numprocesses = auto

# asyncio settings
asyncio_mode = auto

# hypothesis settings
[hypothesis]
deadline = 2000
max_examples = 100
derandomize = True
verbosity = normal

# warnings handling
filterwarnings =
    error
    ignore::DeprecationWarning
    ignore::UserWarning
    ignore::ImportWarning

# Custom test settings
[test-settings]
template_dir = tests/tools/templates
output_dir = test-reports
asset_dir = tests/data
nuclei_templates = tests/data/nuclei_templates
